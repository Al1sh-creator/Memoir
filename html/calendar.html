<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memoir ‚Ä¢ Calendar</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <link rel="stylesheet" href="../css/shared.css">
    <link rel="stylesheet" href="../css/pg1.css">
    <link rel="stylesheet" href="../css/calendar.css">

    <!-- Mobile Navbar -->
    <link rel="stylesheet" href="../css/mobile-navbar.css">
    <script src="../javascript/shared.js"></script>
    <script src="../javascript/auth.js"></script>
    <script src="../javascript/mobile-navbar.js"></script>
    <script>
        // This script must be on every page to initialize the tooltips
        document.addEventListener("DOMContentLoaded", function () {
            // Check authentication first
            if (!auth.requireAuth()) {
                return; // Will redirect to login
            }

            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl)
            })
        });
    </script>
</head>

<body class="bg-light">

    <!-- ================= MOBILE BOTTOM NAVBAR ================= -->
    <nav class="mobile-navbar">
        <a href="pg1.html">
            <i class="bi bi-speedometer"></i>
            <span>Home</span>
        </a>
        <a href="timer.html">
            <i class="bi bi-stopwatch"></i>
            <span>Timer</span>
        </a>
        <a href="Sessions.html">
            <i class="bi bi-book"></i>
            <span>Sessions</span>
            <span class="nav-badge" data-sessions-badge></span>
        </a>
        <a href="calendar.html" class="active">
            <i class="bi bi-calendar3"></i>
            <span>Calendar</span>
        </a>
        <a href="subjects.html">
            <i class="bi bi-mortarboard-fill"></i>
            <span>Subjects</span>
        </a>
        <a href="badges1.html">
            <i class="bi bi-trophy-fill"></i>
            <span>Badges</span>
        </a>
        <a href="analytics.html">
            <i class="bi bi-bar-chart-line"></i>
            <span>Analytics</span>
        </a>
        <a href="settings.html">
            <i class="bi bi-gear"></i>
            <span>Settings</span>
        </a>
    </nav>

    <div class="doodle-layer">
        <span class="doodle circle"></span>
        <span class="doodle zigzag"></span>
        <span class="doodle blob"></span>
        <span class="doodle star"></span>
    </div>

    <div class="d-flex">

        <nav class="sidebar d-flex flex-column align-items-center bg-black vh-100 py-4 rounded d-none d-md-flex">
            <div class="mb-4"><i class="fa-solid fa-owl fs-3 text-white"></i></div>

            <div class="nav-icons d-flex flex-column gap-2">
                <a href="pg1.html" class="text-decoration-none" data-bs-toggle="tooltip" data-bs-placement="right"
                    title="Dashboard">
                    <div class="icon-box "><i class="bi bi-speedometer"></i></div>
                </a>
                <a href="timer.html" class="text-decoration-none" data-bs-toggle="tooltip" data-bs-placement="right"
                    title="Timer">
                    <div class="icon-box "><i class="bi bi-stopwatch"></i></div>
                </a>
                <a href="Sessions.html" class="text-decoration-none" data-bs-toggle="tooltip" data-bs-placement="right"
                    title="Study Sessions">
                    <div class="icon-box">
                        <i class="bi bi-book"></i>
                        <span class="sessions-nav-count" data-sessions-badge></span>
                    </div>
                </a>
                <a href="calendar.html" class="text-decoration-none" data-bs-toggle="tooltip" data-bs-placement="right"
                    title="Calendar">
                    <div class="icon-box active"><i class="bi bi-calendar3"></i></div>
                </a>
                <a href="subjects.html" class="text-decoration-none" data-bs-toggle="tooltip" data-bs-placement="right"
                    title="Subjects">
                    <div class="icon-box"><i class="bi bi-mortarboard-fill"></i></div>
                </a>
                <a href="badges1.html" class="text-decoration-none" data-bs-toggle="tooltip" data-bs-placement="right"
                    title="Badges & Trophies">
                    <div class="icon-box"><i class="bi bi-trophy-fill"></i></div>
                </a>
                <a href="analytics.html" class="text-decoration-none" data-bs-toggle="tooltip" data-bs-placement="right"
                    title="Analytics">
                    <div class="icon-box">
                        <i class="bi bi-bar-chart-line"></i>
                    </div>
                </a>
                <a href="settings.html" class="text-decoration-none" data-bs-toggle="tooltip" data-bs-placement="right"
                    title="Settings">
                    <div class="icon-box"><i class="bi bi-gear"></i></div>
                </a>
            </div>

            <div class="mt-auto mb-3">
                <div class="icon-box logout-btn" data-bs-toggle="tooltip" data-bs-placement="right" title="Logout"
                    onclick="handleLogout()" style="cursor: pointer;">
                    <i class="bi bi-box-arrow-right"></i>
                </div>
            </div>
        </nav>

        <main class="container-fluid p-4">

            <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
                <div>
                    <h1 class="h2 fw-bold">Study Plan</h1>
                </div>
                <div class="d-flex gap-2">
                    <button class="btn btn-dark rounded-pill px-4">+ Session</button>
                    <button class="btn btn-primary rounded-pill px-4"><i
                            class="fa-solid fa-play me-2"></i>Timer</button>
                </div>
            </div>

            <div class="row g-4">

                <div class="col-lg-8">
                    <div class="card border-0 shadow-sm p-4 rounded-4 h-100">

                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h4 class="fw-bold mb-0" id="currentMonthYear">Loading...</h4>
                            <div class="d-flex gap-2">
                                <button class="btn btn-light btn-sm rounded-circle shadow-sm" onclick="changeMonth(-1)">
                                    <i class="bi bi-chevron-left"></i>
                                </button>
                                <button class="btn btn-light btn-sm rounded-circle shadow-sm" onclick="changeMonth(1)">
                                    <i class="bi bi-chevron-right"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Weekly Focus Row -->
                        <div id="weeklyFocusRow" class="focus-row">
                            <div class="focus-title">This Week's Focus</div>
                            <div id="focusChips" class="d-flex flex-wrap"></div>
                            <div class="focus-add">
                                <input id="focusInput" placeholder="Add focus topic" />
                                <button class="btn btn-sm btn-primary" id="addFocusBtn">Add</button>
                            </div>
                            <div class="focus-actions">
                                <button class="btn btn-sm btn-outline-secondary" id="clearFocusBtn">Clear</button>
                            </div>
                        </div>

                        <div class="calendar-grid" id="calendarGrid">
                        </div>
                    </div>
                </div>

                <div class="col-lg-4">
                    <!-- Daily Summary Panel -->
                    <div class="card border-0 shadow-sm p-4 rounded-4 mb-4" id="dailySummaryCard" aria-live="polite">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h6 class="fw-bold mb-0">Daily Summary</h6>
                            <button class="btn btn-sm btn-light rounded-circle" id="clearSummaryBtn"
                                title="Clear selection"><i class="bi bi-x"></i></button>
                        </div>
                        <div id="dailySummaryEmpty" class="text-center text-muted py-5">
                            <i class="bi bi-calendar-check fs-1 mb-3 d-block text-muted opacity-50"></i>
                            <p class="mb-0">Select a day to view its study summary</p>
                        </div>
                        <div id="dailySummary" style="display:none">
                            <!-- Date Header -->
                            <div class="mb-3 pb-3 border-bottom">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <div class="small text-muted mb-1" id="summaryDate">Date</div>
                                        <h4 class="fw-bold mb-1" id="summaryTotalTime">0m</h4>
                                        <small class="text-muted">Total study time</small>
                                    </div>
                                    <div id="summaryStatus" class="text-end"></div>
                                </div>
                            </div>

                            <!-- Focus Score & Productivity -->
                            <div class="mb-3 pb-3 border-bottom" id="focusMetricsSection" style="display:none">
                                <div class="small text-muted fw-bold mb-2">Focus Metrics</div>
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span class="small">Average Focus Score</span>
                                    <span class="badge bg-primary" id="summaryFocusScore">0%</span>
                                </div>
                                <div class="progress mb-2" style="height: 8px;">
                                    <div class="progress-bar" id="summaryFocusBar" role="progressbar" style="width: 0%">
                                    </div>
                                </div>
                                <div class="d-flex gap-2 flex-wrap" id="summaryProductivity"></div>
                            </div>

                            <!-- Subjects -->
                            <div class="mb-3 pb-3 border-bottom">
                                <div class="small text-muted fw-bold mb-2">Subjects</div>
                                <div id="summarySubjects"></div>
                            </div>

                            <!-- Notes -->
                            <div class="mb-3 pb-3 border-bottom">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <div class="small text-muted fw-bold">Notes</div>
                                    <button class="btn btn-sm btn-outline-primary" id="editNoteFromPanel">
                                        <i class="bi bi-pencil"></i> Edit
                                    </button>
                                </div>
                                <div id="summaryNotes" class="small" style="white-space: pre-wrap;"></div>
                            </div>

                            <!-- Sessions List -->
                            <div>
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <div class="small text-muted fw-bold">Sessions (<span id="sessionCount">0</span>)
                                    </div>
                                    <a href="timer.html" class="btn btn-sm btn-success">
                                        <i class="bi bi-plus-circle"></i> Add
                                    </a>
                                </div>
                                <div id="summarySessionsList" class="list-group"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Monthly Tasks Card -->
                    <div class="card border-0 shadow-sm p-4 rounded-4" id="monthTasksCard">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h6 class="fw-bold mb-0">Tasks</h6>
                            <div class="d-flex gap-2">
                                <button class="btn btn-sm btn-outline-secondary" id="clearMonthTasksBtn"
                                    title="Clear all tasks for this month">Clear</button>
                            </div>
                        </div>

                        <div class="mb-3 d-flex gap-2">
                            <input id="taskInput" class="form-control form-control-sm"
                                placeholder="Add a task for this month" />
                            <button class="btn btn-primary btn-sm rounded-circle" id="addTaskBtn" title="Add task"><i
                                    class="bi bi-plus-lg"></i></button>
                        </div>

                        <div id="monthTasksList" class="list-group"></div>
                        <div class="small text-muted mt-2">Tasks are stored per month.</div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div class="modal fade" id="noteModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content rounded-4 border-0 p-3">
                <div class="modal-header border-0">
                    <h5 class="modal-title fw-bold" id="modalTitle">Note</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <textarea id="noteInput" class="form-control bg-light border-0 rounded-3 p-3" rows="5"
                        placeholder="Add a note..."></textarea>
                    <div class="mt-3">
                        <label class="small text-muted fw-bold d-block mb-2">Day Status</label>
                        <div class="status-options" id="statusOptions">
                            <div class="status-btn" data-status="studied">‚úÖ Studied</div>
                            <div class="status-btn" data-status="long">‚è±Ô∏è Long session</div>
                            <div class="status-btn" data-status="missed">üò¥ Missed</div>
                            <div class="status-btn" data-status="productive">‚≠ê Productive</div>
                            <div class="status-btn" data-status="none">Clear</div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-primary rounded-pill px-4" onclick="saveNote()">Save</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../javascript/calendar.js"></script>

    <script>
        function handleLogout() {
            auth.logout();
            window.location.href = 'landing.html';
        }
    </script>
</body>

</html>