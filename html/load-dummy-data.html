<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Load Dummy Data - Memoir</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .container {
            max-width: 600px;
        }

        .card {
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 12px 30px;
            font-weight: 600;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            display: none;
        }

        .status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .data-info {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .data-info h6 {
            color: #667eea;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .data-info ul {
            margin-bottom: 0;
            padding-left: 20px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="card">
            <div class="card-body p-5">
                <h2 class="text-center mb-4">üìä Load Dummy Data</h2>
                <p class="text-muted text-center mb-4">
                    Click the button below to populate your Memoir app with sample data for testing.
                </p>

                <div class="data-info">
                    <h6>üì¶ What will be loaded:</h6>
                    <ul class="small">
                        <li><strong>3 Test Users</strong> (Alice, Bob, Charlie)</li>
                        <li><strong>45+ Study Sessions</strong> with realistic consecutive patterns over 14 days</li>
                        <li><strong>7-Day Active Streak</strong> ending today with focus scores and metrics</li>
                        <li><strong>5 Subjects</strong> (Mathematics, Physics, Chemistry, Biology, Computer Science)
                        </li>
                        <li><strong>Earned Badges</strong> for achievements</li>
                        <li><strong>Calendar Entries</strong> with notes and tasks</li>
                    </ul>
                </div>

                <div class="text-center mt-4">
                    <button id="loadDataBtn" class="btn btn-primary btn-lg">
                        üöÄ Load Dummy Data
                    </button>
                </div>

                <div id="status" class="status"></div>

                <div class="mt-4 text-center">
                    <small class="text-muted">
                        Default password for all users: <code>password123</code>
                    </small>
                </div>

                <div class="mt-3 text-center">
                    <a href="login.html" class="btn btn-outline-secondary">Go to Login</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('loadDataBtn').addEventListener('click', function () {
            try {
                loadDummyData();
                showStatus('‚úÖ Dummy data loaded successfully! You can now login with any of the test users.', 'success');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 2000);
            } catch (error) {
                showStatus('‚ùå Error loading data: ' + error.message, 'error');
            }
        });

        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = 'status ' + type;
            statusDiv.style.display = 'block';
        }

        function loadDummyData() {
            // Create dummy users
            const users = [
                {
                    id: '1001',
                    name: 'Alice Johnson',
                    email: 'alice@example.com',
                    password: 'password123',
                    createdAt: new Date('2026-01-15').toISOString(),
                    settings: {
                        theme: 'light',
                        accent: '#0d6efd',
                        compact: false,
                        focusDuration: '25',
                        displayName: 'Alice'
                    },
                    stats: {
                        totalSessions: 55,
                        totalTime: 82000,
                        currentStreak: 10,
                        badges: ['streak_3', 'streak_7', 'consistency_5', 'focus_80']
                    }
                },
                {
                    id: '1002',
                    name: 'Bob Smith',
                    email: 'bob@example.com',
                    password: 'password123',
                    createdAt: new Date('2026-01-20').toISOString(),
                    settings: {
                        theme: 'dark',
                        accent: '#6f42c1',
                        compact: true,
                        focusDuration: '30',
                        displayName: 'Bob'
                    },
                    stats: {
                        totalSessions: 28,
                        totalTime: 50400,
                        currentStreak: 4,
                        badges: ['first_session', 'night_owl']
                    }
                },
                {
                    id: '1003',
                    name: 'Charlie Davis',
                    email: 'charlie@example.com',
                    password: 'password123',
                    createdAt: new Date('2026-02-01').toISOString(),
                    settings: {
                        theme: 'system',
                        accent: '#198754',
                        compact: false,
                        focusDuration: '20',
                        displayName: 'Charlie'
                    },
                    stats: {
                        totalSessions: 12,
                        totalTime: 14400,
                        currentStreak: 2,
                        badges: ['first_session']
                    }
                }
            ];

            // Create dummy subjects
            const subjects = [
                {
                    id: 'subj_1',
                    name: 'Mathematics',
                    goal: 40,
                    color: '#0d6efd',
                    icon: 'üìê',
                    createdAt: new Date('2026-01-15').toISOString()
                },
                {
                    id: 'subj_2',
                    name: 'Physics',
                    goal: 35,
                    color: '#6f42c1',
                    icon: '‚öõÔ∏è',
                    createdAt: new Date('2026-01-16').toISOString()
                },
                {
                    id: 'subj_3',
                    name: 'Chemistry',
                    goal: 30,
                    color: '#198754',
                    icon: 'üß™',
                    createdAt: new Date('2026-01-17').toISOString()
                },
                {
                    id: 'subj_4',
                    name: 'Biology',
                    goal: 45,
                    color: '#20c997',
                    icon: 'üß¨',
                    createdAt: new Date('2026-01-18').toISOString()
                },
                {
                    id: 'subj_5',
                    name: 'Computer Science',
                    goal: 50,
                    color: '#fd7e14',
                    icon: 'üíª',
                    createdAt: new Date('2026-01-19').toISOString()
                }
            ];

            // to create dummy data with realistic data
            const sessions = [];
            const now = new Date();
            const subjectIds = subjects.map(s => s.id);
            const subjectNames = subjects.map(s => s.name);

            // helper function to get productivity label based on focus score
            function getProductivityLabel(score) {
                if (score >= 75) return "Focused";
                if (score >= 40) return "Average";
                return "Distracted";
            }

            // helper to create a session
            function createSession(id, daysAgo, hourOfDay, subjectIndex, focusType, note = '') {
                const sessionDate = new Date(now);
                sessionDate.setDate(sessionDate.getDate() - daysAgo);
                sessionDate.setHours(hourOfDay, Math.floor(Math.random() * 60), 0, 0);

                let durationSeconds, pauseCount, inactiveCount;

                // Generate inputs based on desired type to ensure formula yields correct range
                if (focusType === 'focused') {
                    // Long sessions, few interruptions -> High Score (75+)
                    durationSeconds = [1800, 2400, 3000, 3600][Math.floor(Math.random() * 4)]; // 30-60 min
                    pauseCount = Math.floor(Math.random() * 3); // 0-2 pauses
                    inactiveCount = Math.floor(Math.random() * 2); // 0-1 distractions
                } else if (focusType === 'average') {
                    // Medium sessions, moderate interruptions -> Med Score (40-74)
                    durationSeconds = [1200, 1500, 1800, 2400][Math.floor(Math.random() * 4)]; // 20-40 min
                    pauseCount = 3 + Math.floor(Math.random() * 3); // 3-5 pauses
                    inactiveCount = 1 + Math.floor(Math.random() * 2); // 1-2 distractions
                } else {
                    // Short sessions, many interruptions -> Low Score (<40)
                    durationSeconds = [600, 900, 1200][Math.floor(Math.random() * 3)]; // 10-20 min
                    pauseCount = 4 + Math.floor(Math.random() * 5); // 4-8 pauses
                    inactiveCount = 3 + Math.floor(Math.random() * 4); // 3-6 distractions
                }

                // --- NEW FOCUS SCORE FORMULA ---
                const minutes = Math.max(10, durationSeconds / 60);
                const timeMultiplier = 25 / minutes;
                const PENALTY_PAUSE = 6;
                const PENALTY_INACTIVE = 12;

                let penalty = (pauseCount * PENALTY_PAUSE) + (inactiveCount * PENALTY_INACTIVE);
                penalty *= timeMultiplier;

                const focusScore = Math.max(0, Math.round(100 - penalty));
                const productivity = getProductivityLabel(focusScore);
                // -------------------------------

                return {
                    id: 'session_' + id,
                    subject: subjectNames[subjectIndex],
                    subjectId: subjectIds[subjectIndex],
                    date: sessionDate.toISOString().split('T')[0],
                    durationSeconds: durationSeconds,
                    pauseCount: pauseCount,
                    inactiveCount: inactiveCount,
                    focusScore: focusScore,
                    productivity: productivity,
                    timestamp: sessionDate.getTime(),
                    createdAt: sessionDate.getTime(),
                    completed: true,
                    note: note
                };
            }

            let sessionId = 1000;

            // Last 10 days: GUARANTEED Active streak (matches Calendar & Dashboard logic)
            // ensuring >30mins, >60% focus, and "Focused" status.
            for (let daysAgo = 0; daysAgo < 10; daysAgo++) {
                const sessionsPerDay = 1 + Math.floor(Math.random() * 2); // 1-2 sessions

                for (let sessionNum = 0; sessionNum < sessionsPerDay; sessionNum++) {
                    // Use Noon (12:00) to avoid timezone/date boundary issues
                    const hour = 12 + sessionNum;
                    const subjectIndex = Math.floor(Math.random() * subjects.length);
                    // FORCE 'focused' type to ensure streak criteria are met
                    const focusType = 'focused';
                    const note = daysAgo === 0 && sessionNum === 0 ? 'Great study session today!' : '';

                    sessions.push(createSession(sessionId++, daysAgo, hour, subjectIndex, focusType, note));
                }
            }

            // Days 7-13: Mix of focused and average sessions (some days might be skipped)
            for (let daysAgo = 7; daysAgo < 14; daysAgo++) {
                // 70% chance of having sessions on this day
                if (Math.random() < 0.7) {
                    const sessionsPerDay = 1 + Math.floor(Math.random() * 2); // 1-2 sessions

                    for (let sessionNum = 0; sessionNum < sessionsPerDay; sessionNum++) {
                        const hour = 10 + Math.floor(Math.random() * 9); // 10 AM - 7 PM
                        const subjectIndex = Math.floor(Math.random() * subjects.length);
                        const rand = Math.random();
                        const focusType = rand < 0.5 ? 'focused' : rand < 0.85 ? 'average' : 'distracted';

                        sessions.push(createSession(sessionId++, daysAgo, hour, subjectIndex, focusType));
                    }
                }
            }

            // Days 14-29: Sparse older sessions for history
            for (let daysAgo = 14; daysAgo < 30; daysAgo++) {
                // 30% chance of having a session on this day
                if (Math.random() < 0.3) {
                    const hour = 10 + Math.floor(Math.random() * 8);
                    const subjectIndex = Math.floor(Math.random() * subjects.length);
                    const rand = Math.random();
                    const focusType = rand < 0.4 ? 'focused' : rand < 0.75 ? 'average' : 'distracted';

                    sessions.push(createSession(sessionId++, daysAgo, hour, subjectIndex, focusType));
                }
            }

            // Sort sessions by date (newest first)
            sessions.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            // Create earned badges that match the badges page
            const earnedBadges = [
                {
                    id: 'streak_3',
                    name: 'Streak Starter',
                    description: '3-day focus streak',
                    icon: 'üî•',
                    earnedAt: new Date('2026-01-18').toISOString()
                },
                {
                    id: 'consistency_5',
                    name: 'Consistency Champ',
                    description: 'Study on 5 days',
                    icon: 'üìÖ',
                    earnedAt: new Date('2026-01-20').toISOString()
                },
                {
                    id: 'focus_80',
                    name: 'Focus Beast',
                    description: '80%+ focus day',
                    icon: 'üß†',
                    earnedAt: new Date('2026-01-22').toISOString()
                },
                {
                    id: 'deep_worker',
                    name: 'Deep Worker',
                    description: '2+ hours in one day',
                    icon: '‚è±',
                    earnedAt: new Date('2026-01-25').toISOString()
                }
            ];

            // Create calendar data
            const calendarNotes = {};
            const calendarStatus = {};
            const weeklyFocus = {};
            const monthTasks = {};

            // Add some sample notes and statuses
            for (let i = 0; i < 5; i++) {
                const daysAgo = Math.floor(Math.random() * 14);
                const noteDate = new Date(now);
                noteDate.setDate(noteDate.getDate() - daysAgo);
                const dateKey = noteDate.toISOString().split('T')[0];

                calendarNotes['note_' + dateKey] = 'Sample note for ' + dateKey;
                calendarStatus['status_' + dateKey] = ['productive', 'normal', 'challenging'][Math.floor(Math.random() * 3)];
            }

            // Add weekly focus items
            const currentWeekKey = getWeekKey(now);
            weeklyFocus['weekly_focus_' + currentWeekKey] = [
                { text: 'Complete Math assignment', done: true },
                { text: 'Review Physics chapters 1-3', done: false },
                { text: 'Practice Chemistry problems', done: false }
            ];

            // Add monthly tasks
            const currentMonthKey = getMonthKey(now.getFullYear(), now.getMonth());
            monthTasks['month_tasks_' + currentMonthKey] = [
                { text: 'Prepare for midterm exams', done: false },
                { text: 'Complete project proposal', done: true },
                { text: 'Study group sessions', done: false }
            ];

            // Save all data to localStorage
            localStorage.setItem('memoir_users', JSON.stringify(users));
            localStorage.setItem('subjects', JSON.stringify(subjects));

            // Populate Alice, Bob, and Charlie with data
            users.forEach(user => {
                const userId = user.id;

                // Give Alice the full session set, others smaller portions
                let userSessions = sessions;
                if (userId === '1002') userSessions = sessions.slice(10, 30);
                if (userId === '1003') userSessions = sessions.slice(0, 10);

                localStorage.setItem(`memoir_sessions_${userId}`, JSON.stringify(userSessions));
                localStorage.setItem(`memoir_badges_${userId}`, JSON.stringify(earnedBadges));

                // Save calendar data for this user
                Object.keys(calendarNotes).forEach(key => {
                    localStorage.setItem(`memoir_${key}_${userId}`, calendarNotes[key]);
                });
                Object.keys(calendarStatus).forEach(key => {
                    localStorage.setItem(`memoir_${key}_${userId}`, calendarStatus[key]);
                });
                Object.keys(weeklyFocus).forEach(key => {
                    localStorage.setItem(`memoir_${key}_${userId}`, JSON.stringify(weeklyFocus[key]));
                });
                Object.keys(monthTasks).forEach(key => {
                    localStorage.setItem(`memoir_${key}_${userId}`, JSON.stringify(monthTasks[key]));
                });

                // Set goals for users
                localStorage.setItem(`memoir_goal_daily_${userId}`, '4');
                localStorage.setItem(`memoir_goal_weekly_${userId}`, '20');
                localStorage.setItem(`memoir_goal_monthly_${userId}`, '80');
                localStorage.setItem(`memoir_goal_total_${userId}`, '200');

                // Set default focus duration
                localStorage.setItem(`memoir_focus_duration_${userId}`, user.settings.focusDuration || '25');
            });

            console.log('‚úÖ Dummy data loaded successfully with user-specific keys!');
            console.log('Users:', users.length);
            console.log('Subjects:', subjects.length);
            console.log('Sessions:', sessions.length);
            console.log('Badges:', earnedBadges.length);
        }

        function getWeekKey(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? -6 : 1);
            const monday = new Date(d.setDate(diff));
            return monday.toISOString().split('T')[0];
        }

        function getMonthKey(year, month) {
            return `${year}-${String(month + 1).padStart(2, '0')}`;
        }
    </script>
</body>

</html>